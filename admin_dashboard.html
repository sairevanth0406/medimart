<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Medimart</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <style>
        :root {
            --primary: #0070d1;
            --primary-dark: #0054a3;
            --secondary: #f8f9fa;
            --accent: #00d1a0;
            --dark: #121212;
            --light: #ffffff;
            --muted: #6c757d;
            --border: rgba(255, 255, 255, 0.15);
        }

        body {
            font-family: 'Inter', Arial, sans-serif;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.8), rgba(0, 70, 120, 0.9)), url('https://images.unsplash.com/photo-1584308666744-24d5c474f2ae?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2070&q=80');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: var(--light);
        }

        .navbar {
            background-color: rgba(0, 0, 0, 0.7) !important;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            padding: 1rem 0;
            transition: all 0.3s ease;
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .brand-logo {
            width: 40px;
            height: 40px;
            background-color: var(--primary);
            color: var(--light);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.5rem;
            font-family: 'Poppins', sans-serif;
        }

        .brand-text {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1.5rem;
            letter-spacing: -0.5px;
        }

        .navbar-nav .nav-link {
            color: var(--light) !important;
            font-weight: 500;
            padding: 0.5rem 1rem;
            margin: 0 0.25rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .navbar-nav .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .navbar-nav .nav-link.active {
            background-color: var(--primary);
            color: var(--light) !important;
        }

        .dashboard-container {
            min-height: calc(100vh - 180px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem 1rem;
        }

        .dashboard-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .dashboard-title {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 2.5rem;
            background: linear-gradient(to right, #ffffff, #a3d9ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 0.5rem;
        }

        .dashboard-subtitle {
            color: rgba(255, 255, 255, 0.6);
            font-size: 1.1rem;
        }

        .dashboard-stats {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid var(--border);
            padding: 1.5rem;
            width: 200px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 0.75rem;
        }

        .stat-card p {
            font-size: 1.75rem;
            font-weight: 600;
            color: var(--light);
        }

        .summary-section {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid var(--border);
            padding: 1.5rem;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            text-align: left;
            transition: transform 0.3s ease;
        }

        .summary-section:hover {
            transform: translateY(-5px);
        }

        .summary-section h3 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1.25rem;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 1rem;
        }

        .summary-section p {
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.6);
            line-height: 1.6;
        }

        .footer {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            padding: 2rem 0;
            position: relative;
            border-top: 1px solid var(--border);
        }

        .copyright {
            color: rgba(255, 255, 255, 0.5);
            text-align: center;
            font-size: 0.9rem;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes scaleIn {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 1s ease-out forwards;
        }

        .slide-up {
            animation: slideUp 0.8s ease-out forwards;
        }

        .scale-in {
            animation: scaleIn 0.8s ease-out forwards;
        }

        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }
        .delay-4 { animation-delay: 0.4s; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark fade-in">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <div class="brand-logo">M</div>
                <span class="brand-text">Medimart</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="admin_dashboard.html">Dashboard</a>
                    </li>
                    <!-- <li class="nav-item">
                        <a class="nav-link" href="add_employee.html">Add Employee</a>
                    </li> -->
                    <li class="nav-item">
                        <a class="nav-link" href="add_medicine.html">Add Medicine</a>
                    </li>
                    <!-- <li class="nav-item">
                        <a class="nav-link" href="suppliers.html">View Suppliers</a>
                    </li> -->
                    <!-- <li class="nav-item">
                        <a class="nav-link" href="purchase_records.html">View Purchase Records</a>
                    </li> -->
                </ul>
            </div>
        </div>
    </nav>

    <!-- Admin Dashboard Section -->
    <section class="dashboard-container">
        <div class="dashboard-header fade-in">
            <h1 class="dashboard-title">Admin Dashboard</h1>
            <p class="dashboard-subtitle">Here is an overview of Medimart's current status.</p>
        </div>

        <!-- Replace the dashboard-stats div with this -->
        <div class="dashboard-stats slide-up delay-1">
            <!-- <div class="stat-card">
                <h3>Total Sales Today</h3>
                <p id="totalSales">Loading...</p> -->
            </div>
        </div>

        <!-- Remove the dashboard-stats div entirely -->
        <div class="summary-section slide-up delay-2">
            <h3>Sales Summary</h3>
            <div class="recent-orders">
                <table class="table table-dark table-hover">
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody id="ordersList">
                        <tr>
                            <td colspan="2">Loading orders...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- Update the script section -->
        <!-- Remove the first updateAdminDashboard script section and keep only this one -->
        <script>
            async function checkAdminAuth() {
                // Add your admin authentication check here
                // This prevents unauthorized access to the dashboard
            }
    
            // Update the updateAdminDashboard function
            async function updateAdminDashboard() {
                try {
                    const response = await fetch('http://localhost:3000/api/admin/dashboard-data');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    console.log('Dashboard data received:', data); // Debug log
                    
                    // Update only the existing stat cards
                    document.querySelector('.stat-card:nth-child(1) p').textContent = data.medicinesInStock || '0';
                    document.querySelector('.stat-card:nth-child(2) p').textContent = formatCurrency(data.salesToday || 0);
                    document.querySelector('.stat-card:nth-child(3) p').textContent = data.totalCustomers || '0';
            
                    // Update summary section with recent orders
                    const recentOrdersList = (data.recentOrders || []).map(order => `
                        <li class="mb-3">
                            <strong>Order #${order.orderId}</strong> - ${order.status}
                            <br>
                            <small>User ID: ${order.userId}</small>
                            <br>
                            <small>Date: ${formatDate(order.orderDate)}</small>
                            <div class="mt-1">
                                <strong>Total: ${formatCurrency(order.total)}</strong>
                            </div>
                        </li>
                    `).join('');
            
                    // Update summary section
                    const summaryHTML = `
                        <h3>System Summary</h3>
                        <div class="row">
                            <div class="col-md-6">
                                <h4 class="mb-3">Today's Statistics</h4>
                                <ul class="list-unstyled">
                                    <li>Orders Today: ${data.ordersToday || 0}</li>
                                    <li>Sales Today: ${formatCurrency(data.salesToday || 0)}</li>
                                    <li>Total Sales: ${formatCurrency(data.totalSales || 0)}</li>
                                </ul>
                            </div>
                        </div>
                        
                        <h4 class="mt-4 mb-3">Recent Orders</h4>
                        <ul class="list-unstyled">
                            ${recentOrdersList || '<li>No recent orders</li>'}
                        </ul>
                        
                        <p class="text-muted mt-3">Last Updated: ${formatDate(new Date())}</p>
                    `;
            
                    document.querySelector('.summary-section').innerHTML = summaryHTML;
                } catch (error) {
                    console.error('Error updating admin dashboard:', error);
                    document.querySelector('.summary-section').innerHTML = `
                        <h3>System Summary</h3>
                        <p class="text-danger">Error loading dashboard data: ${error.message}</p>
                    `;
                }
            }
        
            // Fix the deleteEmployee function
            async function deleteEmployee(id) {
                if (!confirm('Are you sure you want to delete this employee?')) return;
                
                try {
                    const response = await fetch(`http://localhost:3000/api/employees/${id}`, {
                        method: 'DELETE'
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        alert('Employee deleted successfully!');
                        fetchEmployees(); // Refresh the table
                    } else {
                        throw new Error(data.error || 'Failed to delete employee');
                    }
                } catch (error) {
                    console.error('Error deleting employee:', error);
                    alert('Failed to delete employee: ' + error.message);
                }
            }
        
            // Initialize everything when the page loads
            document.addEventListener('DOMContentLoaded', async () => {
                await checkAdminAuth();
                await updateAdminDashboard();
                await fetchEmployees();
                
                // Set up periodic updates
                setInterval(updateAdminDashboard, 3000); // Update every 3 seconds
            });
        </script>

        <!-- <div class="summary-section slide-up delay-2">
            <h3>System Summary</h3>
            <p>Medimart Pharmacy Management System is currently operating smoothly. Inventory levels are stable with no critical shortages reported. The sales performance today is above average compared to the past week, indicating strong customer engagement.</p>
            <p>Employee attendance and performance are being monitored, with all shifts adequately staffed. Supplier deliveries for essential medicines are on schedule, and no major disruptions are expected in the coming week.</p>
            <p>Periodic maintenance of the system is scheduled to ensure data security and operational efficiency. As always, admins are advised to regularly review system logs and reports for any anomalies or irregularities.</p>
        </div> -->
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p class="copyright">&copy; 2025 Medimart Pharmacy Management System. All rights reserved.</p>
        </div>
    </footer>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>

    <script>
    async function updateAdminDashboard() {
        try {
            const response = await fetch('http://localhost:3000/api/admin/dashboard-data');
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const data = await response.json();
            
            // Format currency
            const formatCurrency = (amount) => {
                return new Intl.NumberFormat('en-IN', {
                    style: 'currency',
                    currency: 'INR',
                    minimumFractionDigits: 2
                }).format(amount);
            };

            // Update orders list
            const ordersHTML = (data.recentOrders || [])
                .map(order => `
                    <tr>
                        <td>#${order.orderId}</td>
                        <td>${formatCurrency(order.total)}</td>
                    </tr>
                `).join('');

            document.getElementById('ordersList').innerHTML = ordersHTML || `
                <tr>
                    <td colspan="2">No orders found</td>
                </tr>
            `;

        } catch (error) {
            console.error('Error updating dashboard:', error);
            document.getElementById('ordersList').innerHTML = `
                <tr>
                    <td colspan="2">Error loading orders: ${error.message}</td>
                </tr>
            `;
        }
    }

    // Update every second
    setInterval(updateAdminDashboard, 1000);

    // Initial load
    document.addEventListener('DOMContentLoaded', () => {
        updateAdminDashboard();
    });
    </script>

    <script>
        // Add this function to fetch and display employees
        async function fetchEmployees() {
            try {
                const response = await fetch('http://localhost:3000/api/employees');
                const data = await response.json();
                
                const employeeTableBody = document.querySelector('#employeeTable tbody');
                employeeTableBody.innerHTML = '';
                
                data.employees.forEach(employee => {
                    const row = `
                        <tr>
                            <td>${employee.id}</td>
                            <td>${employee.firstName} ${employee.lastName}</td>
                            <td>${employee.email}</td>
                            <td>${employee.role}</td>
                            <td>
                                <button class="btn btn-sm btn-danger" onclick="deleteEmployee(${employee.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                    employeeTableBody.innerHTML += row;
                });
            } catch (error) {
                console.error('Error fetching employees:', error);
            }
        }
    </script>
</body>
</html>